# Custom Actions

Use Custom Actions to build integrations directly into Frame.io as programmable UI components. Currently, Custom Actions are available for Assets, and are displayed in the context menu on any Asset. To build your own Custom Actions app, our sample apps will get you started:

* [JavaScript](https://github.com/Frameio/custom-actions-example-app)
* [Python](https://github.com/Frameio/custom-actions-app-python)

## Configure Your Custom Action

 When a user selects a Custom Action on an Asset, Frame.io sends a payload to a URL you provide. The receiving application can respond with an HTTP status code to acknowledge receipt, or respond with a custom callback that renders additional UI in Frame.io.

> Workspace Manager permissions are required to create Customer Actions for a Workspace. Ask your admin to modify your permissions if you don't have access.

Configure Custom Actions here: [Custom Actions](https://developer.frame.io/actions). An action requires:

| Field name     | Description     |
| ---------- | ---------- |
| Name       | The name you choose for your Custom Action. It will be shown in the menu of available Custom Actions in Frame.io.|
| Description       | Explain what the action does, for reference (the description won't appear in the Frame.io web app).|
| Event       | Internal event key to help you differentiate between standard webhook events and your own.|
| URL       | Where to deliver events.|
| Workspace       | The Workspace that will use the Custom Action.|

# What's in the Payload From Frame.io?

When the user clicks your Custom Action, a payload is sent to the URL you set in the URL field. Use this payload to identify:

* Which Custom Actions were clicked
* Which resource was clicked
* Which user took the action

```json
POST /your/url
{
    "account_id": "9a44f696-ae69-4e0c-9731-806d27ea46f1",
    "action_id": "ecd40785-4485-4f07-9d26-a006ea84efdf",
    "interaction_id": "e0a1c945-a8da-480d-92fb-e895cb640a01",
    "project":
    {
        "id": "3dda6833-ec3b-46bd-a7d9-1a77c03a165b"
    },
    "resource":
    {
        "id": "f9d5728c-ac1a-4f48-92bb-ea2f9be3c58b",
        "type": "file"
    },
    "type": "two.event",
    "user":
    {
        "adobe_auth_id": "7FFE1E0368095AD00A494229@AdobeID",
        "id": "50d976e6-27d2-47cb-9388-45b38d55f4f0"
    },
    "workspace":
    {
        "id": "382a1fe6-67cf-481e-9b65-79cfd9e9727f"
    }
}
```

| Field name     | Description     |
| ---------- | ---------- |
| `action_id`       | The unique id of this Action. It is always be the same for a given Action.|
| `interaction_id`       | This is a unique identifier generated by Frame.io that you can use to keep track of your transaction. This identifier is the same throughout any sequence of an Action, including callback forms.|
| `type`       | The name of the event you put in the Event field when configuring your Action.|
| `resource.id`       | The id of the resource from which you triggered your Action (usually an Asset).|
| `resource.type`       | The type of resource from which you triggered your Action (usually *asset*).|

##  Interactions, Retries and Timeouts

The `interaction_id` is a unique identifier to track of the interaction as it evolves over time. If you do not need to respond to the user, return a 200 status code, and you're done. While optional, we recommend including information about the result of the action, like a success message or error alert. Custom actions support message callbacks.

Frame.io expects a response in less than 5 seconds, and attempts to retry up to 5 times while waiting for a succesful response. Ideally the response is immediate and asynchronous actions occur after a trigger via a Custom Action.

## Create a Message Callback

In your HTTP response to the webhook event, you can return a JSON object describing a message that will be returned to the initiating user in the Frame.io UI. To test build a message, try our [Custom Action Builder](https://developer.frame.io/app/custom-actions/builder), which allows you to set up message callbacks or forms and see how they would appear in the Frame.io web app. Here's an example object:

```json
{
  "title": "Success!",
  "description": "The thing worked! Nice."
}
```

Messages close the action loop providing variable context to the user, without asking them to switch contexts. When the initial payload and subsequent calls to the Frame.io API don't provide enough context for the receiving application, use **Form Callbacks**.

## Create a Form Callback

Let's say that you need more info before you start your process. For example, you may be uploading content to a system that requires additional details and settings. You can describe a Form in your response, which the user sees snd fills out, and is then sent right back to you! Here's an example form that renders a Form in the Frame.io UI that the acting user can fill out and submit:

```json
{
  "title": "Need some more info!",
  "description": "Getting ready to submit this file!",
  "fields": [
    {
      "type": "text",
      "label": "Title",
      "name": "title",
      "value": "MyVideo.mp4"
    },
    {
      "type": "select",
      "label": "Captions",
      "name": "captions",
      "options": [
        {
          "name": "Off",
          "value": "off"
        },
        {
          "name": "On",
          "value": "on"
        }
      ]
    }
  ]
}
```

When the user submits the form, you'll receive an event on the same URL as the initial POST:

```json
POST /your/urlâ€‹
{
  "type": "your-specified-event-name",
  "interaction_id": "the-same-id-as-before",
  "action_id": "unique-id-for-this-custom-action",
  "data":{
    "title": "MyVideo.mp4",
    "captions": "off"
  }
}
```

All custom fields added on a form appear in the `data` section of the JSON payload sent by Frame.io. Use the `interaction_id` to map the initial request and this new form data. And again, you can respond with a message (or even another form!). By chaining Actions, Forms, and Messages, you can effectively program entire Asset workflows in Frame.io with business logic from an external system. The sky's the limit.

### Form details

Like messages, Forms support `title` and `description` attributes that render at the top of the Form. Beyond that, each form field accepts the following base attributes:

* `type` -- Tells the Frame.io UI which type of data to expect, and which component and render.
* `label` -- Appears on the UI as the header above the field.
* `name` -- Key by which the field will be identified on the subsequent payload.
* `value` -- Value with which to pre-populate the field.

#### Supported Field Types

**Text field**:
A simple text field with no additional parameters.

```json
{  
  "type": "text",
  "label": "Title",
  "name": "title",
  "value": "MyVideo.mp4"
}
```

**Text area**:
A simple text area with no additional parameters.

```json
{  
  "type": "textarea",
  "label": "Description",
  "name": "description",
  "value": "This video is really, really popular."
}
````

**Select list**:
Defines a picklist that the user can choose from. Must include an `options` list, each member of which should include a human-readable `name`, and a machine-parseable `value`.

```json
{
  "type": "select",
  "label": "Captions",
  "name": "captions",
  "value": "off",
  "options": [
       {
         "name": "Off",
         "value": "off"
       },
       {
         "name": "On",
         "value": "on"
      }
   ]
}
```

# The Frame.io Permissions Model

Webhooks and Custom Actions have a special permissions model: they belong to a Workspace, not to any specific user who exists on a Team or Account.  That means:

* Any Admin or Workspace Manager can create a Custom Action on a Workspace.
* Any Admin or Workspace Manager can modify or delete a Custom Action that exists on a Team.  Once modified, all users will immediately see the result of the change.

## Security and Verification

By default, all Custom Actions have a signing key generated during their creation. This is not configurable. This key can be used to verify that the request originates from Frame.io. Included in the `POST` request are the following:

| Name     | Description     |
| ---------- | ---------- |
| `X-Frameio-Request-Timestamp`       | The time your Custom Action was triggered.       |
| `X-Frameio-Signature`       | The computed signature.       |

* **The timestamp** is the time the request was signed on its way out of Frame.io's network. This can be used to prevent replay attacks. We recommended verifying this time is within 5 minutes of local time.
* **The signature** is a HMAC SHA-256 hash using the signing key provided when the Custom Action is first created.

## Verifying the Signature

1. Extract the signature from the HTTP headers.
2. Create a message to sign by combining the version, delivery time, and request body `v0:timestamp:body`.
3. Compute the HMAC SHA256 signature using your signing secret.

> **Note**: The provided signature is prefixed with `v0=`. Currently Frame.io only has this one version for signing requests. You will need to add this prefix to your computed signature.

Compare!

```python
import hmac
import hashlib

def verify_signature(curr_time, req_time, signature, body, secret):
    """
    Verify webhook/custom action signature
    :Args:
        curr_time (float): Current epoch time
        req_time (float): Request epoch time
        signature (str): Signature provided by the frame.io API for the given request
        body (str): Custom Action body from the received POST
        secret (str): The secret for this Custom Action that you saved when you first created it
    """
    if int(curr_time) - int(req_time) < 500:
        message = 'v0:{}:{}'.format(req_time, body)
        calculated_signature = 'v0={}'.format(hmac.new(
            bytes(secret, 'latin-1'),
            msg=bytes(message, 'latin-1'),
            digestmod=hashlib.sha256).hexdigest())
        if calculated_signature == signature:
            return True
    return False
```
